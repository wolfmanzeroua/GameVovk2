<!doctype html>
<html>
<head>
    <title>BattleField</title>
    <style>-->
    .list {
        width: auto;
        height: auto;
        background-color: white;
        padding: 3px;
        clear:both;
        border: 1px solid lightgray;
    }


    </style>
</head>
<body>


<div style="width: 224px; height: 600px; float: left; border: 1px solid lightgray;">
    <div style =" background-color: lightsteelblue;  float: none; border: 1px solid lightgray; text-align: center;" ><b> List of Heroes </b></div>
    <div id = "list" style =" width: auto; height: auto; background-color: white; float: none; border: 1px solid lightgray; position: relative " ><b> </b></div>
</div>

<svg id="mySvg" width="801" height="601" style="background-color: whitesmoke"  xmlns="http://www.w3.org/2000/svg">
    <text x="0" y="598" fill="red"><tspan style="font-size: 10px;">(0,0)</tspan></text>
    <text x="0" y="300" fill="red"><tspan style="font-size: 10px;">(0,300)</tspan></text>
    <text x="0" y="10" fill="red"><tspan style="font-size: 10px;">(0,600)</tspan></text>

    <text x="770" y="598" fill="red"><tspan style="font-size: 10px;">(800,0)</tspan></text>
    <text x="760" y="300" fill="red"><tspan style="font-size: 10px;">(800,300)</tspan></text>
    <text x="760" y="10" fill="red"><tspan style="font-size: 10px;">(800,600)</tspan></text>

    <text x="380" y="598" fill="red"><tspan style="font-size: 10px;">(400,0)</tspan></text>
    <text x="380" y="10" fill="red"><tspan style="font-size: 10px;">(400,600)</tspan></text>




</svg>



<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>

<script>


    // http://habrahabr.ru/post/37595/

    var socket = io();


    socket.on('initMap', function(msg){

        function setColor(type) {
            /* Тип перешкод, type
             * 1 - Ліс
             * 2 - Болото
             * 3 - Гора
             * 4 - Озеро
             */

            if (type == 1) return 'LightGreen';
            if (type == 2) return 'Tan';
            if (type == 3) return 'DimGray';
            if (type == 4) return 'SkyBlue';

        }
        //$('#messages').append($('<li>').text(msg));
        //console.dir(msg);
        //console.log(msg.fіgura);
        if(msg.fіgura == 1) {
            //малюємо трикутник
            //console.log('трикутник')
            //   console.dir(msg);
            addTriangleToSvg(setColor(msg.type),msg.x1,600 - msg.y1, msg.x2,600 - msg.y2,msg.x3,600 - msg.y3);

        }

        if(msg.fіgura == 2) {
            //малюємо прямокутник
            //console.log('прямокутник')
            //   console.dir(msg);

            addRectangleToSvg(setColor(msg.type),msg.x1,600 - msg.y1, msg.x2,600 - msg.y2,msg.x3,600 - msg.y3, msg.x4,600 - msg.y4);

        }

        if(msg.fіgura == 3) {
            //малюємо еліпс
            // addElipseToSvg(color,x,y,rx,ry)
            //           console.dir(msg);
            //   console.dir(msg);
            addElipseToSvg(setColor(msg.type),msg.cx,600 - msg.cy, msg.rx, msg.ry);


        }
        // console.log(JSON.parse(msg));
    });

    socket.on('initHero', function(msg){
        initHero(msg); });

    socket.on('moveHero', function(msg){
        moveHero(msg); });

    function addTriangleToSvg(color,x1,y1,x2,y2,x3,y3) {

        //circle.addEventListener('click', click, false);
        // console.log(color,x1,y1,x2,y2,x3,y3);
        var c1 = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        c1.setAttribute("points",x1 + "," + y1 + "," + x2 + "," + y2 + "," + x3 + "," + y3);
        c1.setAttribute("fill", color);
        document.getElementById('mySvg').appendChild(c1);
    }

    function addRectangleToSvg(color,x1,y1,x2,y2,x3,y3,x4,y4) {

        var c2 = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        c2.setAttribute("points",x1 + "," + y1 + "," + x2 + "," + y2 + "," + x3 + "," + y3 + "," + x4 + "," + y4);
        c2.setAttribute("fill", color);
        document.getElementById('mySvg').appendChild(c2);
    }

    function addElipseToSvg(color,cx,cy,rx,ry) {
        //<ellipse cx="100" cy="70" rx="85" ry="55" fill="Tan" />

        var c3 = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
        c3.setAttribute("cx","" + cx);
        c3.setAttribute("cy","" + cy);
        c3.setAttribute("rx","" + rx);
        c3.setAttribute("ry","" + ry);
        c3.setAttribute("fill", color);
        document.getElementById('mySvg').appendChild(c3);
    }

    // XMen(clan, name, health, attackRange, invisible, canShoot, x, y)

    function moveHero(msg) {
        hero = msg.hero;
        heroNumber = msg.heroNumber;
        console.dir(msg);

        //  var areaColor = '#0A0EF2';
        console.log("" + hero.name + heroNumber);
        //circle.addEventListener('click', click, false);

        var c1 = document.getElementById("" + hero.name + heroNumber);
        c1.setAttribute("cx", hero.x + "px");
        c1.setAttribute("cy",(600 - hero.y) + "px");
        //c1.setAttribute("r", hero.attackRange + "px");
        // c1.setAttribute("id", "" + hero.name + heroNumber);

        if (hero.health <= 0) {
            c1.setAttribute("fill", "black");

        }



        // Добавляємо героя в DIV Геро ліст

        var heroDiv = document.getElementById( "list" + hero.name + heroNumber);
        //newDiv.setAttribute("id", "" + hero.name + heroNumber);
        //newDiv.setAttribute("class", "list");
        heroDiv.innerHTML = hero.name +  "\u2764" + hero.health + " (" + hero.x + "," + hero.y + ")";
        if (hero.health <= 0) {
            heroDiv.style.color = "black";
            heroDiv.innerHTML = "\u2671" + hero.name +  "\u2764" + hero.health + " (" + hero.x + "," + hero.y + ")";

        }


    }

    function initHero  (msg) {
        hero = msg.hero;
        heroNumber = msg.heroNumber;
        console.dir(msg);

        var areaColor = '#0A0EF2';
        // console.log(mySvg);
        //circle.addEventListener('click', click, false);


        if (hero.clan == 'Vampires') {
            areaColor = 'red';

        }

        var c1 = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        c1.setAttribute("cx", hero.x + "px");
        c1.setAttribute("cy",(600 - hero.y) + "px");
        c1.setAttribute("r", hero.attackRange + "px");
        c1.setAttribute("id", "" + hero.name + heroNumber);
        c1.setAttribute("fill", areaColor);
        c1.setAttribute("opacity", "0.5");
        document.getElementById('mySvg').appendChild(c1);

        // Добавляємо героя в DIV Геро ліст
        var newDiv = document.createElement("div");
        newDiv.setAttribute("id", "list" + hero.name + heroNumber);
        newDiv.setAttribute("class", "list");
        newDiv.style.color = areaColor;
        var node = document.createTextNode(hero.name +  "\u2764" + hero.health + " (" + hero.x + "," + hero.y + ")");
        newDiv.appendChild(node);
        document.getElementById('list').appendChild(newDiv);

    }


</script>

</body>
</html>